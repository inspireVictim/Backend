# üìã –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å:
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ users
SELECT * FROM "users" WHERE "Id" = 15;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
-- - Id = 15
-- - IsActive = true (–∞–∫—Ç–∏–≤–µ–Ω)
-- - IsBlocked = false (–Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
```

#### –ö–æ—à–µ–ª–µ–∫ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å:
```sql
-- –ö–æ—à–µ–ª–µ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ wallets
SELECT * FROM "wallets" WHERE "UserId" = 15;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
-- - UserId = 15
-- - Balance (–º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π, –≤ —Ç–æ–º —á–∏—Å–ª–µ 0.00)
```

### 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (PAY)

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|--------|----------|
| `command` | `pay` | `pay` | –ö–æ–º–∞–Ω–¥–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è |
| `txn_id` | –î–æ 20 —Ü–∏—Ñ—Ä | `12345678901234567890` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `account` | 1-10 —Ü–∏—Ñ—Ä | `15` | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ |
| `sum` | `XX.XX` | `100.00` | –°—É–º–º–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏) |

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|--------|----------|
| `txn_date` | `yyyyMMddHHmmss` | `20231205143000` | –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è) |

### 3. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–∞

```
GET https://5.59.232.211:8443/api/v1/optima/payment?command=pay&txn_id=12345678901234567890&account=15&sum=100.00
```

**–ò–ª–∏ —Å –¥–∞—Ç–æ–π:**
```
GET https://5.59.232.211:8443/api/v1/optima/payment?command=pay&txn_id=12345678901234567890&txn_date=20231205143000&account=15&sum=100.00
```

### 4. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏

1. ‚úÖ –ó–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (account = User.Id)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `PaymentProviderTransactions`
5. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `transactions` (type='topup')
6. ‚úÖ –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `wallets` (balance += sum)
7. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è XML –æ—Ç–≤–µ—Ç —Å result=0

### 5. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∞–∫—Ç–∏–≤–µ–Ω
```sql
SELECT 
    "Id",
    "Phone",
    "IsActive",
    "IsBlocked"
FROM "users"
WHERE "Id" = 15;
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `IsActive = true`
- `IsBlocked = false`

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ö–æ—à–µ–ª–µ–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```sql
SELECT 
    "UserId",
    "Balance",
    "YescoinBalance"
FROM "wallets"
WHERE "UserId" = 15;
```

**–ö–æ—à–µ–ª–µ–∫ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å** (–µ—Å–ª–∏ –Ω–µ—Ç - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å).

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: API –¥–æ—Å—Ç—É–ø–µ–Ω
```bash
curl -k "https://5.59.232.211:8443/api/v1/health"
```

**–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:** `{"status":"ok",...}`

### 6. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

#### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç–∞ (CHECK)
```bash
curl -k "https://5.59.232.211:8443/api/v1/optima/payment?command=check&txn_id=12345678901234567890&account=15&sum=100.00"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```xml
<response>
    <osmp_txn_id>12345678901234567890</osmp_txn_id>
    <sum>100.00</sum>
    <result>0</result>
    <comment>OK</comment>
</response>
```

#### –®–∞–≥ 2: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞ (PAY)
```bash
curl -k "https://5.59.232.211:8443/api/v1/optima/payment?command=pay&txn_id=12345678901234567891&account=15&sum=100.00"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```xml
<response>
    <osmp_txn_id>12345678901234567891</osmp_txn_id>
    <sum>100.00</sum>
    <result>0</result>
    <comment>OK</comment>
</response>
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
```sql
SELECT 
    u."Id",
    u."Phone",
    w."Balance",
    w."TotalEarned"
FROM "users" u
JOIN "wallets" w ON u."Id" = w."UserId"
WHERE u."Id" = 15;
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `Balance` —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 100.00
- `TotalEarned` —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 100.00

### 7. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ë–î

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω—É–ª—è, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO "users" (
    "Id", "Name", "Email", "Phone", "PasswordHash",
    "PhoneVerified", "EmailVerified", "IsActive", "IsBlocked",
    "DeviceTokens", "PushEnabled", "SmsEnabled", "CreatedAt", "UpdatedAt"
) VALUES (
    15, 
    '–¢–µ—Å—Ç –ë–∞–Ω–∫', 
    'bank.test@yess-test.com', 
    '+996555111111',
    '$2a$10$r8Q3HvK5xZ8mN9pL7qJ1qOeM6XvY2wB1cD3fG4hI5jK6lM7nO8pQ9r',
    true, true, true, false,
    '[]'::jsonb, true, true, NOW(), NOW()
);

-- 2. –°–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª–µ–∫
INSERT INTO "wallets" (
    "UserId", "Balance", "YescoinBalance", "TotalEarned", "TotalSpent", "LastUpdated"
) VALUES (
    15, 0.00, 0.00, 0.00, 0.00, NOW()
);
```

### 8. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- –ö–æ—à–µ–ª–µ–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω (`IsActive = true`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (`IsBlocked = false`)
- –§–æ—Ä–º–∞—Ç —Å—É–º–º—ã: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏ (`100.00`, –Ω–µ `100` –∏–ª–∏ `100.5`)
- txn_id —É–Ω–∏–∫–∞–ª–µ–Ω (–∏–ª–∏ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç)

‚ö†Ô∏è **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
- txn_date –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- IP –∞–¥—Ä–µ—Å –±–∞–Ω–∫–∞ –≤ whitelist (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ IP)

‚ùå **–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)
- –ü–∞—Ä–æ–ª—å (–¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –Ω—É–∂–µ–Ω)
- –î—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è

### 9. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –∫–æ—à–µ–ª–µ–∫ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã (ID=15), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -k "https://5.59.232.211:8443/api/v1/optima/payment?command=pay&txn_id=$(date +%s)&account=15&sum=100.00"
```

–ì–¥–µ `$(date +%s)` - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π txn_id).

---

## ‚úÖ –ò—Ç–æ–≥–æ: –ú–∏–Ω–∏–º—É–º –¥–ª—è —Ç–µ—Å—Ç–∞

1. **–í –ë–î:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (ID=15) + –ö–æ—à–µ–ª–µ–∫ –¥–ª—è –Ω–µ–≥–æ
2. **–í –∑–∞–ø—Ä–æ—Å–µ:** `command=pay` + `txn_id` + `account=15` + `sum=100.00`
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞

**–í—Å—ë!** –û—Å—Ç–∞–ª—å–Ω–æ–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.

